@model TmsSystem.Models.TripOffer

@{
    ViewData["Title"] = "פרטי הצעת מחיר לטיול";
}

<style>
    /* עיצוב כללי */
    .trip-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .trip-title {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .offer-badge {
        background: white;
        color: #667eea;
        padding: 8px 20px;
        border-radius: 20px;
        font-weight: bold;
        display: inline-block;
        margin-top: 10px;
    }

    . info-card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        overflow: hidden;
        transition: transform 0.3s;
    }

        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .info-card . card-header {
            font-weight: bold;
            font-size: 1.2rem;
            padding: 15px 20px;
        }

        .info-card . card-body {
            padding: 20px;
        }

    . bg-purple {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .guide-info-row {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-top: 10px;
    }
    .price-card {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        border-radius: 15px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .price-amount {
        font-size: 3rem;
        font-weight: bold;
        margin: 20px 0;
    }

    .price-breakdown {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
    }

        .price-breakdown table {
            margin-bottom: 0;
        }

    /* לוח זמנים - ימי הטיול */
    .trip-day-card {
        border-right: 5px solid #667eea;
        margin-bottom: 20px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .trip-day-header {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 20px;
        font-weight: bold;
        font-size: 1.3rem;
    }

    .trip-day-body {
        padding: 20px;
        background: #f8f9fa;
    }

    .trip-day-image {
        width: 100%;
        height: 300px;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .trip-day-description {
        font-size: 1.05rem;
        line-height: 1.8;
        color: #333;
    }

    /* תנאי ביטול ותשלום */
    .border-blue-primary {
        border-color: #0066cc !important;
        border-width: 2px;
    }

    .border-blue-secondary {
        border-color: #4a90e2 !important;
        border-width: 2px;
    }

    .bg-blue-primary {
        background-color: #0066cc !important;
    }

    . bg-blue-secondary {
        background-color: #4a90e2 !important;
    }

    . bg-light-blue {
        background-color: #e6f2ff !important;
    }

    . bg-light-blue-terms {
        background-color: #f0f7ff !important;
    }

    . text-blue-primary {
        color: #0066cc !important;
    }

    .text-blue-secondary {
        color: #4a90e2 !important;
    }

    .text-blue-dark {
        color: #003d7a !important;
    }

    . text-orange {
        color: #ff8c00 !important;
    }

    . terms-content {
        padding: 15px;
    }

    . term-item {
        padding: 12px;
        margin-bottom: 10px;
        background-color: white;
        border-right: 4px solid #0066cc;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

        .term-item i {
            font-size: 1.2em;
            vertical-align: middle;
        }

        .term-item strong {
            color: #003d7a;
            font-size: 1.05em;
        }

    .bank-details {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

        .bank-details p {
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .bank-details strong {
            color: #003d7a;
        }

    .mr-2 {
        margin-left: 8px;
    }

    .status-badge {
        padding: 8px 15px;
        border-radius: 20px;
        font-weight: bold;
        display: inline-block;
    }

    .status-pending {
        background: #ffc107;
        color: #000;
    }

    .status-approved {
        background: #28a745;
        color: #fff;
    }

    .status-rejected {
        background: #dc3545;
        color: #fff;
    }

    .status-cancelled {
        background: #6c757d;
        color: #fff;
    }

    @@media print {
        .no-print

    {
        display: none !important;
    }

    .card {
        break-inside: avoid;
        page-break-inside: avoid;
    }

    .trip-day-card {
        break-inside: avoid;
        page-break-inside: avoid;
    }

    }
</style>

<div class="container-fluid mt-4">
    <!-- כותרת ראשית -->
    <div class="trip-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                @if (Model.Trip != null)
                {
                    <h1 class="trip-title">@Model.Trip.Title</h1>
                    <p class="mb-0"><i class="fas fa-calendar-check"></i> @Model.Trip.NumberOfDays ימים | <i class="fas fa-users"></i> @Model.Participants משתתפים</p>
                }
                <div class="offer-badge">
                    <i class="fas fa-file-invoice"></i> הצעת מחיר: @Model.OfferNumber
                </div>
            </div>
            <div class="no-print">
                @{
                    var statusClass = Model.Status switch
                    {
                        "Pending" => "status-pending",
                        "Approved" => "status-approved",
                        "Rejected" => "status-rejected",
                        "Cancelled" => "status-cancelled",
                        _ => "status-pending"
                    };
                    var statusText = Model.Status switch
                    {
                        "Pending" => "ממתין",
                        "Approved" => "מאושר",
                        "Rejected" => "נדחה",
                        "Cancelled" => "בוטל",
                        _ => Model.Status
                    };
                }
                <span class="status-badge @statusClass">
                    <i class="fas fa-flag"></i> @statusText
                </span>
            </div>
        </div>
    </div>

    <!-- כפתורי פעולה -->
    <div class="row mb-4 no-print">
        <div class="col-12">
            <div class="btn-group" role="group">
                <a asp-action="Edit" asp-route-id="@Model.TripOfferId" class="btn btn-warning btn-lg">
                    <i class="fas fa-edit"></i> עריכה
                </a>
                <a asp-action="Index" class="btn btn-secondary btn-lg">
                    <i class="fas fa-arrow-right"></i> חזרה לרשימה
                </a>
                <button onclick="window.print()" class="btn btn-info btn-lg">
                    <i class="fas fa-print"></i> הדפסה/PDF
                </button>
                <button type="button" class="btn btn-success btn-lg" onclick="sendEmailOffer(@Model.TripOfferId)">
                    <i class="fas fa-envelope"></i> שליחה במייל
                </button>
            </div>
        </div>
    </div>

    <!-- פרטי הלקוח והטיול -->
    <div class="row">
        <!-- פרטי הלקוח -->
        <div class="col-md-6">
            <div class="info-card card">
                <div class="card-header bg-primary text-white">
                    <i class="fas fa-user-circle"></i> פרטי הלקוח
                </div>
                <div class="card-body">
                    @if (Model.Customer != null)
                    {
                        <p><strong><i class="fas fa-user"></i> שם:</strong> @Model.Customer.DisplayName</p>
                        <p><strong><i class="fas fa-envelope"></i> אימייל:</strong> <a href="mailto:@Model. Customer.Email">@Model.Customer.Email</a></p>
                        <p><strong><i class="fas fa-phone"></i> טלפון:</strong> <a href="tel:@Model. Customer.Phone">@Model.Customer.Phone</a></p>
                        @if (!string.IsNullOrEmpty(Model.Customer.CompanyName))
                        {
                            <p><strong><i class="fas fa-building"></i> חברה:</strong> @Model.Customer.CompanyName</p>
                        }
                        @if (!string.IsNullOrEmpty(Model.Customer.Address))
                        {
                            <p><strong><i class="fas fa-map-marker-alt"></i> כתובת:</strong> @Model.Customer.Address</p>
                        }
                    }
                    else
                    {
                        <p class="text-muted">אין פרטי לקוח</p>
                    }
                </div>
            </div>
        </div>

        <!-- פרטי הטיול -->
        <div class="col-md-6">
            <div class="info-card card">
                <div class="card-header bg-info text-white">
                    <i class="fas fa-plane-departure"></i> פרטי הטיול
                </div>
                <div class="card-body">
                    @if (Model.Trip != null)
                    {
                        <p><strong><i class="fas fa-map-marked-alt"></i> טיול:</strong> @Model.Trip.Title</p>
                        <p><strong><i class="fas fa-calendar-alt"></i> משך:</strong> @Model.Trip.NumberOfDays ימים / @(Model.Trip.NumberOfDays - 1) לילות</p>
                        <p><strong><i class="fas fa-calendar-day"></i> תאריך יציאה:</strong> @Model.DepartureDate.ToString("dd/MM/yyyy")</p>
                        @if (Model.ReturnDate.HasValue)
                        {
                            <p><strong><i class="fas fa-calendar-day"></i> תאריך חזרה:</strong> @Model.ReturnDate.Value.ToString("dd/MM/yyyy")</p>
                        }
                        <p><strong><i class="fas fa-users"></i> מספר משתתפים:</strong> @Model.Participants</p>
                        @if (Model.SingleRooms > 0)
                        {
                            <p><strong><i class="fas fa-bed"></i> חדרים יחידים:</strong> @Model.SingleRooms</p>
                        }
                    }
                </div>
            </div>
        </div>
    </div>


</div> <!-- סגירת row קיים -->
<!-- פרטי מדריך -->
<div class="row mt-3">
    <div class="col-md-12">
        @if (Model.Trip?.Guide != null)
        {
            <div class="info-card card">
                <div class="card-header @(Model.Trip.GuideId == 9 ? "bg-warning text-dark" : "bg-purple text-white")">
                    <i class="fas fa-user-tie"></i> מדריך מלווה
                    @if (Model.Trip.GuideId == 9)
                    {
                        <span class="badge bg-danger ms-2">לא משוייך</span>
                    }
                </div>
                <div class="card-body">
                    @if (Model.Trip.GuideId == 9)
                    {
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>שימו לב:</strong> המדריך המקורי נמחק מהמערכת.  יש לשייך מדריך חדש לטיול.
                        </div>
                    }
                    else
                    {
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong><i class="fas fa-user"></i> שם המדריך:</strong> @Model. Trip.Guide.GuideName</p>
                                @if (!string.IsNullOrEmpty(Model.Trip.Guide.Phone))
                                {
                                    <p><strong><i class="fas fa-phone"></i> טלפון:</strong> <a href="tel:@Model. Trip.Guide.Phone">@Model.Trip.Guide.Phone</a></p>
                                }
                            </div>
                            <div class="col-md-6">
                                @if (!string.IsNullOrEmpty(Model.Trip.Guide.Email))
                                {
                                    <p><strong><i class="fas fa-envelope"></i> אימייל:</strong> <a href="mailto:@Model.Trip.Guide.Email">@Model.Trip.Guide.Email</a></p>
                                }
                                @if (!string.IsNullOrEmpty(Model.Trip.Guide.Description))
                                {
                                    <p><strong><i class="fas fa-info-circle"></i> תיאור:</strong> @Model.Trip.Guide.Description</p>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
        else if (Model.Trip?.GuideId != null)
        {
            <div class="info-card card">
                <div class="card-header bg-warning text-dark">
                    <i class="fas fa-user-tie"></i> מדריך מלווה
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        המדריך לא נטען.  GuideId: @Model.Trip.GuideId
                    </div>
                </div>
            </div>
        }
    </div>
</div>

    <!-- תיאור הטיול -->
    @if (Model.Trip != null && !string.IsNullOrEmpty(Model.Trip.Description))
    {
        <div class="row">
            <div class="col-12">
                <div class="info-card card">
                    <div class="card-header bg-secondary text-white">
                        <i class="fas fa-info-circle"></i> אודות הטיול
                    </div>
                    <div class="card-body">
                        <p class="lead">@Model.Trip.Description</p>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- לוח זמנים - ימי הטיול -->
    @if (Model.Trip?.TripDays != null && Model.Trip.TripDays.Any())
    {
        <div class="row mt-4">
            <div class="col-12">
                <h2 class="mb-4"><i class="fas fa-route"></i> לוח זמנים מפורט</h2>

                @foreach (var day in Model.Trip.TripDays.OrderBy(d => d.DayNumber))
                {
                    <div class="trip-day-card card">
                        <div class="trip-day-header">
                            <i class="fas fa-calendar-day"></i> יום @day.DayNumber - @day.Title
                            @if (!string.IsNullOrEmpty(day.Location))
                            {
                                <span class="float-end"><i class="fas fa-map-marker-alt"></i></span>
                            }
                        </div>
                        <div class="trip-day-body">
                            <div class="row">
                                @if (!string.IsNullOrEmpty(day.ImagePath))
                                {
                                    <div class="col-md-5">
                                        <img src="@day.ImagePath" alt="@day.Title" class="trip-day-image" />
                                    </div>
                                    <div class="col-md-7">
                                        <div class="trip-day-description">
                                            @Html.Raw(day.Description?.Replace("\n", "<br>"))
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="col-12">
                                        <div class="trip-day-description">
                                            @Html.Raw(day.Description?.Replace("\n", "<br>"))
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- מה כלול / לא כלול -->
    @if (Model.Trip != null && (!string.IsNullOrEmpty(Model.Trip.Includes) || !string.IsNullOrEmpty(Model.Trip.Excludes)))
    {
        <div class="row mt-4">
            @if (!string.IsNullOrEmpty(Model.Trip.Includes))
            {
                <div class="col-md-6">
                    <div class="info-card card">
                        <div class="card-header bg-success text-white">
                            <i class="fas fa-check-circle"></i> מה כלול במחיר
                        </div>
                        <div class="card-body">
                            @Html.Raw(Model.Trip.Includes.Replace("\n", "<br>"))
                        </div>
                    </div>
                </div>
            }
            @if (!string.IsNullOrEmpty(Model.Trip.Excludes))
            {
                <div class="col-md-6">
                    <div class="info-card card">
                        <div class="card-header bg-danger text-white">
                            <i class="fas fa-times-circle"></i> לא כלול במחיר
                        </div>
                        <div class="card-body">
                            @Html.Raw(Model.Trip.Excludes.Replace("\n", "<br>"))
                        </div>
                    </div>
                </div>
            }
        </div>
    }

    <!-- פרטי טיסה -->
    @if (Model.FlightIncluded && !string.IsNullOrEmpty(Model.Trip?.FlightDetails))
    {
        <div class="row mt-4">
            <div class="col-12">
                <div class="info-card card">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-plane"></i> פרטי טיסה
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info mb-0">
                            <i class="fas fa-check-circle"></i> <strong>טיסה כלולה במחיר</strong>
                        </div>
                        <div class="mt-3">
                            @Html.Raw(Model.Trip.FlightDetails.Replace("\n", "<br>"))
                        </div>
                        @if (!string.IsNullOrEmpty(Model.FlightDetails))
                        {
                            <hr>
                            <h6><i class="fas fa-info-circle"></i> פרטים נוספים:</h6>
                            <p>@Model.FlightDetails</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- פירוט מחירים -->
    <div class="row mt-4">
        <div class="col-md-8">
            <div class="info-card card">
                <div class="card-header bg-success text-white">
                    <i class="fas fa-calculator"></i> פירוט מחירים
                </div>
                <div class="card-body price-breakdown">
                    <table class="table table-hover">
                        <tbody>
                            <tr>
                                <td><i class="fas fa-user"></i> מחיר לאדם</td>
                                <td class="text-end"><strong>$@Model.PricePerPerson.ToString("N2")</strong></td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-users"></i> מספר משתתפים</td>
                                <td class="text-end"><strong>@Model.Participants</strong></td>
                            </tr>
                            <tr class="table-light">
                                <td><strong>סה"כ בסיסי</strong></td>
                                <td class="text-end"><strong>$@((Model.PricePerPerson * Model.Participants).ToString("N2"))</strong></td>
                            </tr>
                            @if (Model.SingleRoomSupplement.HasValue && Model.SingleRooms > 0)
                            {
                                <tr>
                                    <td><i class="fas fa-bed"></i> תוספת חדר יחיד (@Model.SingleRooms חדרים x $@Model.SingleRoomSupplement.Value. ToString("N2"))</td>
                                    <td class="text-end"><strong>$@((Model.SingleRoomSupplement.Value * Model.SingleRooms).ToString("N2"))</strong></td>
                                </tr>
                            }
                            @if (Model.InsuranceIncluded && Model.InsurancePrice.HasValue)
                            {
                                <tr>
                                    <td><i class="fas fa-shield-alt"></i> ביטוח נסיעות (@Model. Participants x $@Model.InsurancePrice.Value.ToString("N2"))</td>
                                    <td class="text-end"><strong>$@((Model.InsurancePrice.Value * Model.Participants).ToString("N2"))</strong></td>
                                </tr>
                            }
                            <tr class="table-success">
                                <td><h5 class="mb-0"><i class="fas fa-dollar-sign"></i> <strong>סה"כ לתשלום</strong></h5></td>
                                <td class="text-end"><h4 class="mb-0 text-success"><strong>$@Model.TotalPrice.ToString("N2")</strong></h4></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="price-card">
                <div><i class="fas fa-tags fa-3x"></i></div>
                <div class="price-amount">$@Model.TotalPrice.ToString("N2")</div>
                <p class="mb-0">סה"כ לתשלום</p>
                <hr style="border-color: rgba(255,255,255,0.3);">
                <p class="mb-1"><small>מקדמה (50%)</small></p>
                <h5><strong>$@((Model.TotalPrice * 0.5m).ToString("N2"))</strong></h5>
            </div>
        </div>
    </div>

    <!-- בקשות מיוחדות והערות -->
    @if (!string.IsNullOrEmpty(Model.SpecialRequests) || !string.IsNullOrEmpty(Model.AdditionalNotes))
    {
        <div class="row mt-4">
            <div class="col-12">
                <div class="info-card card">
                    <div class="card-header bg-warning text-dark">
                        <i class="fas fa-sticky-note"></i> הערות ובקשות מיוחדות
                    </div>
                    <div class="card-body">
                        @if (!string.IsNullOrEmpty(Model.SpecialRequests))
                        {
                            <h6><i class="fas fa-comment-dots"></i> בקשות מיוחדות:</h6>
                            <p class="alert alert-light">@Model.SpecialRequests</p>
                        }
                        @if (!string.IsNullOrEmpty(Model.AdditionalNotes))
                        {
                            <h6><i class="fas fa-file-alt"></i> הערות נוספות:</h6>
                            <p class="alert alert-light">@Model.AdditionalNotes</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- תנאי ביטול ותשלום - סקציה קבועה -->
    <div class="row mt-4 mb-4">
        <div class="col-12">
            <div class="card border-blue-primary">
                <div class="card-header bg-blue-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-file-contract"></i> תנאי ביטול ותשלום</h5>
                </div>
                <div class="card-body bg-light-blue-terms">
                    <div class="terms-content">
                        <div class="term-item">
                            <i class="fas fa-hand-holding-usd text-blue-primary mr-2"></i>
                            <strong>תשלום מקדמה:</strong> על מנת לשריין את הטיול יש להעביר מקדמה של 50% עם אישור ההזמנה.  יש לסיים את כל התשלום עד 7 ימים עסקים מיום יציאת הטיול.
                        </div>
                        <div class="term-item">
                            <i class="fas fa-calendar-alt text-blue-primary mr-2"></i>
                            <strong>דחיית תאריך:</strong> במידה ותרצו לדחות את התאריך עד 14 יום לפני הטיול ניתן לעשות זאת ללא עלות.
                        </div>
                        <div class="term-item">
                            <i class="fas fa-times-circle text-warning mr-2"></i>
                            <strong>ביטול עד 30 יום:</strong> במידה ותרצו לבטל את הטיול עד 30 יום לפני הטיול, תקבלו החזר פחות 300$ דמי טיפול.
                        </div>
                        <div class="term-item">
                            <i class="fas fa-exclamation-triangle text-orange mr-2"></i>
                            <strong>ביטול 30-14 ימים:</strong> ביטול שיתקיים בין 30 יום ל-14 יום לפני מועד הטיול - יגבו דמי ביטול של 50% מהמחיר.
                        </div>
                        <div class="term-item">
                            <i class="fas fa-ban text-danger mr-2"></i>
                            <strong>ביטול עד 14 ימים:</strong> ביטול שיתקיים בין 14 יום ליום הטיול - יגבו דמי ביטול מלאים.
                        </div>
                        <div class="term-item">
                            <i class="fas fa-shield-alt text-blue-primary mr-2"></i>
                            <strong>ביטול מטעמנו:</strong> במידה ולא ניתן לקיים את הטיול, ואנו נבטל אותו בשל תנאים ביטחוניים או תנאי מזג אויר, ולא תרצו מועד חלופי - תשלום מלא יוחזר.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- פרטי תשלום מפורטים -->
    <div class="row mt-4 mb-4">
        <div class="col-12">
            <div class="card border-blue-primary">
                <div class="card-header bg-blue-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-credit-card"></i> פרטי תשלום</h5>
                </div>
                <div class="card-body bg-light-blue">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-blue-dark">אמצעי תשלום</h6>
                            @if (Model.PaymentMethod != null)
                            {
                                <p><i class="fas fa-money-bill-wave text-blue-primary mr-2"></i>@Model.PaymentMethod.PaymentName</p>
                            }
                            else
                            {
                                <p><i class="fas fa-question-circle text-blue-secondary mr-2"></i>טרם נקבע</p>
                            }

                            @if (Model.PaymentInstallments.HasValue && Model.PaymentInstallments.Value > 1)
                            {
                                <p><i class="fas fa-list-ol text-blue-primary mr-2"></i><strong>תשלומים:</strong> @Model.PaymentInstallments.Value תשלומים</p>
                                <p><strong>תשלום חודשי:</strong> $@((Model.TotalPrice / Model.PaymentInstallments.Value).ToString("N2"))</p>
                            }
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-blue-dark">סכום לתשלום</h6>
                            <p class="fw-bold text-blue-primary fs-4">$@Model.TotalPrice.ToString("N2")</p>
                            <p class="text-muted">מקדמה נדרשת (50%): <strong>$@((Model.TotalPrice * 0.5m).ToString("N2"))</strong></p>
                        </div>
                    </div>

                    <div class="payment-details mt-3">
                        <h6 class="text-blue-dark"><i class="fas fa-university"></i> פרטי העברה בנקאית</h6>
                        <div class="bank-details bg-white p-3 rounded border">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>שם הבנק:</strong> בנק לאומי</p>
                                    <p><strong>מספר סניף:</strong> 805</p>
                                    <p><strong>מספר חשבון:</strong> 39820047</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>שם בעל החשבון:</strong> TRYIT Travel Ltd. </p>
                                    <p><strong>ח.פ:</strong> 515323970</p>
                                    <p class="text-blue-dark"><strong>סכום להעברה:</strong> $@Model.TotalPrice.ToString("N2")</strong></p>
                                </div>
                            </div>
                            <div class="mt-3 p-2 bg-light border-end border-primary border-4">
                                <p class="mb-0"><strong>לתשומת לבכם:</strong> נא לציין בהעברה את מספר ההצעה: <strong class="text-primary">@Model.OfferNumber</strong></p>
                            </div>
                        </div>
                    </div>

                    <div class="contact-info mt-4">
                        <h6 class="text-blue-dark"><i class="fas fa-phone"></i> ליצירת קשר</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <p><i class="fas fa-phone text-blue-primary mr-2"></i><a href="tel:0587818560">058-7818560</a></p>
                                <p><i class="fas fa-envelope text-blue-primary mr-2"></i><a href="mailto:info@tryit.co.il">info@tryit. co.il</a></p>
                            </div>
                            <div class="col-md-6">
                                <p><i class="fas fa-globe text-blue-primary mr-2"></i><a href="https://www.tryit.co.il" target="_blank">www.tryit.co.il</a></p>
                                <p><i class="fas fa-map-marker-alt text-blue-primary mr-2"></i>תל אביב , ישראל</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- מידע נוסף -->
    <div class="row mt-4 mb-4">
        <div class="col-md-6">
            <div class="info-card card">
                <div class="card-header bg-secondary text-white">
                    <i class="fas fa-info-circle"></i> מידע כללי
                </div>
                <div class="card-body">
                    <p><strong>מספר הצעה:</strong> @Model.OfferNumber</p>
                    <p><strong>תאריך יצירה:</strong> @Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</p>
                    @if (Model.UpdatedAt.HasValue)
                    {
                        <p><strong>עדכון אחרון:</strong> @Model.UpdatedAt.Value.ToString("dd/MM/yyyy HH:mm")</p>
                    }
                    <p><strong>סטטוס:</strong> <span class="badge @statusClass">@statusText</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- כפתורים תחתונים -->
    <div class="row mt-4 mb-4 no-print">
        <div class="col-12 text-center">
            <a asp-action="Edit" asp-route-id="@Model. TripOfferId" class="btn btn-warning btn-lg">
                <i class="fas fa-edit"></i> עריכה
            </a>
            <button type="button" class="btn btn-success btn-lg" onclick="sendEmailOffer(@Model.TripOfferId)">
                <i class="fas fa-envelope"></i> שליחה במייל
            </button>
            <button onclick="window.print()" class="btn btn-info btn-lg">
                <i class="fas fa-print"></i> הדפסה/שמירה כ-PDF
            </button>
            <a asp-action="Index" class="btn btn-secondary btn-lg">
                <i class="fas fa-list"></i> חזרה לרשימה
            </a>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function sendEmailOffer(offerId) {
            if (confirm('האם לשלוח את הצעת המחיר ללקוח במייל? ')) {
                console.log('Sending trip offer email:', offerId);

                // TODO: חיבור למערכת שליחת המיילים
                fetch(`/TripOffers/SendEmail/${offerId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('המייל נשלח בהצלחה ללקוח! ');
                    } else {
                        alert('שגיאה בשליחת המייל: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('שגיאה בשליחת המייל');
                });
            }
        }

        // הדפסה מותאמת
        window.onbeforeprint = function() {
            document.title = 'הצעת_מחיר_@Model. OfferNumber';
        };
    </script>
}