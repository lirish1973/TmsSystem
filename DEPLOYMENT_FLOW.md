# תרשים זרימת הפריסה האוטומטית

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         תהליך פריסה אוטומטית                            │
└─────────────────────────────────────────────────────────────────────────┘

┌──────────────┐
│  מפתח מבצע   │
│    commit    │  ← שינויים בקוד
│  ו-push      │
└──────┬───────┘
       │
       ▼
┌──────────────────────────────────────────────────────────────┐
│                      GitHub Repository                        │
│  ┌────────────────────────────────────────────────────────┐  │
│  │         main branch קיבל עדכון חדש                    │  │
│  └────────────────────────────────────────────────────────┘  │
└──────────┬───────────────────────────────────────────────────┘
           │
           │ הפעלה אוטומטית
           ▼
┌──────────────────────────────────────────────────────────────┐
│                    GitHub Actions                             │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  📦 שלב 1: Checkout Code                              │  │
│  │     משיכת הקוד מ-GitHub                                │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  🔧 שלב 2: Setup .NET 8.0                             │  │
│  │     התקנת .NET SDK                                     │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  📥 שלב 3: Restore Dependencies                       │  │
│  │     dotnet restore                                     │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  🔨 שלב 4: Build Application                          │  │
│  │     dotnet build --configuration Release               │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  📤 שלב 5: Publish Application                        │  │
│  │     dotnet publish -c Release -o ./publish             │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  📦 שלב 6: Create Deployment Package                  │  │
│  │     tar -czf deployment.tar.gz                         │  │
│  └────────────────────────────────────────────────────────┘  │
└──────────┬───────────────────────────────────────────────────┘
           │
           │ העלאה דרך SSH/SCP
           ▼
┌──────────────────────────────────────────────────────────────┐
│            DigitalOcean Server (64.225.67.19)                 │
│                                                               │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  📥 שלב 7: Upload to Server                           │  │
│  │     העלאת deployment.tar.gz ל-/tmp/                   │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  💾 שלב 8: Backup Current Version                     │  │
│  │     יצירת גיבוי של הגרסה הקיימת                      │  │
│  │     backup_YYYYMMDD_HHMMSS.tar.gz                      │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  🛑 שלב 9: Stop Service                               │  │
│  │     systemctl stop tmssystem.service                   │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  🧹 שלב 10: Clean Old Files                           │  │
│  │     מחיקת קבצים ישנים                                 │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  📂 שלב 11: Extract New Version                       │  │
│  │     חילוץ הקבצים החדשים ל-                            │  │
│  │     /var/www/TmsSystem/TmsSystem/                      │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  🔐 שלב 12: Set Permissions                           │  │
│  │     הגדרת הרשאות קבצים                                │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  ▶️  שלב 13: Start Service                            │  │
│  │     systemctl start tmssystem.service                  │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  ✅ שלב 14: Verify Deployment                         │  │
│  │     בדיקת סטטוס השירות                                │  │
│  └────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────┘
           │
           ▼
      ┌─────────┐
      │ ✅ סיום │
      └─────────┘


═══════════════════════════════════════════════════════════════

מבנה קבצים בשרת:

/var/www/TmsSystem/
├── TmsSystem/                    ← קבצי האפליקציה
│   ├── TmsSystem.dll            ← קובץ ראשי
│   ├── appsettings.json         ← הגדרות
│   ├── wwwroot/                 ← קבצים סטטיים
│   └── ...                      ← שאר הקבצים
│
└── backups/                      ← גיבויים
    ├── backup_20260109_080000.tar.gz  ← גיבוי 1
    ├── backup_20260109_120000.tar.gz  ← גיבוי 2
    ├── backup_20260109_160000.tar.gz  ← גיבוי 3
    ├── backup_20260109_200000.tar.gz  ← גיבוי 4
    └── backup_20260110_000000.tar.gz  ← גיבוי 5
    (שומר רק 5 אחרונים)

═══════════════════════════════════════════════════════════════

קבצים נדרשים ב-GitHub Repository:

.github/workflows/
└── deploy-to-digitalocean.yml    ← קובץ Workflow

TmsSystem/
├── TmsSystem.csproj              ← פרויקט .NET
├── Program.cs
└── ...

setup-server.sh                   ← סקריפט הגדרת שרת
generate-ssh-keys.sh              ← סקריפט יצירת מפתחות
DEPLOYMENT_GUIDE.md               ← מדריך מפורט
QUICK_SETUP.md                    ← מדריך מהיר
TROUBLESHOOTING.md                ← פתרון בעיות

═══════════════════════════════════════════════════════════════

GitHub Secrets נדרשים:

┌──────────────────────────┬─────────────────────────────┐
│   שם Secret              │   דוגמה                     │
├──────────────────────────┼─────────────────────────────┤
│ DIGITALOCEAN_HOST        │ 64.225.67.19                │
│ DIGITALOCEAN_USERNAME    │ root                        │
│ DIGITALOCEAN_SSH_KEY     │ -----BEGIN OPENSSH...       │
└──────────────────────────┴─────────────────────────────┘

═══════════════════════════════════════════════════════════════

תהליך בכל פעם שמבצעים push:

1. המפתח עושה:     git push origin main
2. GitHub מזהה:     שינוי ב-main branch
3. Workflow רץ:     בנייה + העלאה לשרת
4. שרת מקבל:        קבצים חדשים
5. שרת עושה:        גיבוי + החלפה + restart
6. המערכת פועלת:    עם הגרסה החדשה! ✅

═══════════════════════════════════════════════════════════════

זמן פריסה טיפוסי: 2-5 דקות

✅ יתרונות:
  • אוטומציה מלאה
  • גיבוי אוטומטי
  • היסטוריה של פריסות ב-GitHub Actions
  • אפשרות לחזור לגרסה קודמת בקלות
  • אין צורך בגישה ידנית לשרת
  • תהליך עקבי ואמין

```
